const wordDatabase = {
  suroboyoan: [
    {
      word: "koncoku",
      hint: "Teman dalam bahasa Surabaya",
      category: "Sosial",
    },
    { word: "arek", hint: "Anak/orang muda", category: "Sosial" },
    { word: "sampean", hint: "Anda/kamu (sopan)", category: "Sapaan" },
    { word: "enyong", hint: "Saya/aku (kasar)", category: "Sapaan" },
    { word: "awakmu", hint: "Kamu", category: "Sapaan" },
    { word: "raimu", hint: "Wajahmu", category: "Tubuh" },
    { word: "matamu", hint: "Matamu", category: "Tubuh" },
    { word: "apik", hint: "Bagus/cantik", category: "Sifat" },
    { word: "elek", hint: "Jelek/buruk", category: "Sifat" },
    { word: "gedhe", hint: "Besar", category: "Sifat" },
    { word: "cilik", hint: "Kecil", category: "Sifat" },
    { word: "abot", hint: "Berat", category: "Sifat" },
    { word: "enteng", hint: "Ringan", category: "Sifat" },
    { word: "panas", hint: "Panas", category: "Sifat" },
    { word: "adhem", hint: "Dingin", category: "Sifat" },
    { word: "gelem", hint: "Mau/ingin", category: "Kata Kerja" },
    { word: "mangan", hint: "Makan", category: "Kata Kerja" },
    { word: "ngopi", hint: "Minum kopi", category: "Kata Kerja" },
    { word: "lungo", hint: "Pergi", category: "Kata Kerja" },
    { word: "turu", hint: "Tidur", category: "Kata Kerja" },
    { word: "tangi", hint: "Bangun tidur", category: "Kata Kerja" },
    { word: "adus", hint: "Mandi", category: "Kata Kerja" },
    { word: "ngombe", hint: "Minum", category: "Kata Kerja" },
    { word: "omah", hint: "Rumah", category: "Benda" },
    { word: "pasar", hint: "Pasar", category: "Tempat" },
    { word: "sekolah", hint: "Sekolah", category: "Tempat" },
    { word: "dalan", hint: "Jalan", category: "Tempat" },
    { word: "kali", hint: "Sungai", category: "Tempat" },
    { word: "opo", hint: "Apa", category: "Tanya" },
    { word: "nang", hint: "Di", category: "Preposisi" },
    { word: "sopo", hint: "Siapa", category: "Tanya" },
    { word: "kapan", hint: "Kapan", category: "Tanya" },
    { word: "piye", hint: "Bagaimana", category: "Tanya" },
    { word: "ngendi", hint: "Dimana", category: "Tanya" },
    { word: "ngalor", hint: "Ke utara", category: "Arah" },
    { word: "ngidul", hint: "Ke selatan", category: "Arah" },
    { word: "ngulon", hint: "Ke barat", category: "Arah" },
    { word: "ngetan", hint: "Ke timur", category: "Arah" },
    { word: "sego", hint: "Nasi", category: "Makanan" },
    { word: "tahu", hint: "Tahu", category: "Makanan" },
    { word: "tempe", hint: "Tempe", category: "Makanan" },
    { word: "sambel", hint: "Sambal", category: "Makanan" },
    {
      word: "rawon",
      hint: "Makanan khas Surabaya berkuah hitam",
      category: "Makanan",
    },
    { word: "rujak", hint: "Rujak cingur", category: "Makanan" },
    { word: "esuk", hint: "Pagi", category: "Waktu" },
    { word: "siang", hint: "Siang", category: "Waktu" },
    { word: "sore", hint: "Sore", category: "Waktu" },
    { word: "bengi", hint: "Malam", category: "Waktu" },
    { word: "sesuk", hint: "Besok", category: "Waktu" },
    { word: "wingi", hint: "Kemarin", category: "Waktu" },
  ],
  malangan: [
    { word: "isun", hint: "Saya/aku dalam bahasa Malang", category: "Sapaan" },
    { word: "koen", hint: "Kamu dalam bahasa Malang", category: "Sapaan" },
    { word: "awakmu", hint: "Kamu", category: "Sapaan" },
    { word: "ngenyek", hint: "Mengejek", category: "Kata Kerja" },
    { word: "mlaku", hint: "Jalan kaki", category: "Kata Kerja" },
    { word: "ngguyu", hint: "Tertawa", category: "Kata Kerja" },
    { word: "nangis", hint: "Menangis", category: "Kata Kerja" },
    { word: "turu", hint: "Tidur", category: "Kata Kerja" },
    { word: "moco", hint: "Membaca", category: "Kata Kerja" },
    { word: "nulis", hint: "Menulis", category: "Kata Kerja" },
    { word: "gendut", hint: "Gemuk", category: "Sifat" },
    { word: "kurus", hint: "Kurus", category: "Sifat" },
    { word: "dhuwur", hint: "Tinggi", category: "Sifat" },
    { word: "cendhek", hint: "Pendek", category: "Sifat" },
    { word: "wagu", hint: "Aneh/tidak bagus", category: "Sifat" },
    { word: "pinter", hint: "Pintar", category: "Sifat" },
    { word: "bodoh", hint: "Bodoh", category: "Sifat" },
    {
      word: "dokar",
      hint: "Kendaraan tradisional beroda ditarik kuda",
      category: "Benda",
    },
    { word: "buku", hint: "Buku", category: "Benda" },
    { word: "meja", hint: "Meja", category: "Benda" },
    { word: "kursi", hint: "Kursi", category: "Benda" },
    {
      word: "bakso",
      hint: "Makanan berkuah dengan bola daging",
      category: "Makanan",
    },
    {
      word: "ceker",
      hint: "Ceker ayam pedas khas Malang",
      category: "Makanan",
    },
    { word: "apel", hint: "Buah khas Malang", category: "Makanan" },
    { word: "aloon", hint: "Alun-alun", category: "Tempat" },
    {
      word: "gunung",
      hint: "Gunung (Malang banyak gunung)",
      category: "Tempat",
    },
    { word: "kampung", hint: "Kampung/desa", category: "Tempat" },
    { word: "apo", hint: "Apa", category: "Tanya" },
    { word: "sopo", hint: "Siapa", category: "Tanya" },
    { word: "kepiye", hint: "Bagaimana", category: "Tanya" },
    { word: "ngendi", hint: "Dimana", category: "Tanya" },
    { word: "esuk", hint: "Pagi", category: "Waktu" },
    { word: "awan", hint: "Siang", category: "Waktu" },
    { word: "sonten", hint: "Sore", category: "Waktu" },
    { word: "dalu", hint: "Malam", category: "Waktu" },
    { word: "ndue", hint: "Punya/memiliki", category: "Kata Kerja" },
    { word: "arep", hint: "Mau/akan", category: "Kata Kerja" },
    { word: "wis", hint: "Sudah", category: "Keterangan" },
    { word: "durung", hint: "Belum", category: "Keterangan" },
    { word: "ojo", hint: "Jangan", category: "Larangan" },
    { word: "kudu", hint: "Harus", category: "Keharusan" },
    { word: "iso", hint: "Bisa", category: "Kemampuan" },
    { word: "ora", hint: "Tidak", category: "Negasi" },
  ],
  jawa: [
    { word: "sugeng", hint: "Selamat", category: "Sapaan" },
    { word: "panjenengan", hint: "Anda (sangat sopan)", category: "Sapaan" },
    { word: "kula", hint: "Saya (krama)", category: "Sapaan" },
    { word: "sampeyan", hint: "Anda (sopan)", category: "Sapaan" },
    { word: "dalem", hint: "Rumah (krama)", category: "Benda" },
    { word: "griya", hint: "Rumah (krama tinggi)", category: "Benda" },
    { word: "pepak", hint: "Lengkap", category: "Sifat" },
    { word: "serat", hint: "Buku/tulisan krama", category: "Benda" },
    { word: "wayang", hint: "Wayang kulit", category: "Budaya" },
    {
      word: "gamelan",
      hint: "Alat musik tradisional Jawa",
      category: "Budaya",
    },
    { word: "ndherek", hint: "Ikut (krama)", category: "Kata Kerja" },
    { word: "dhahar", hint: "Makan (krama)", category: "Kata Kerja" },
    { word: "tindak", hint: "Pergi (krama)", category: "Kata Kerja" },
    { word: "lenggah", hint: "Duduk (krama)", category: "Kata Kerja" },
    { word: "maos", hint: "Membaca (krama)", category: "Kata Kerja" },
    { word: "nyerat", hint: "Menulis (krama)", category: "Kata Kerja" },
    { word: "mireng", hint: "Mendengar (krama)", category: "Kata Kerja" },
    { word: "ningali", hint: "Melihat (krama)", category: "Kata Kerja" },
    { word: "sae", hint: "Baik (krama)", category: "Sifat" },
    { word: "awon", hint: "Buruk (krama)", category: "Sifat" },
    { word: "ageng", hint: "Besar (krama)", category: "Sifat" },
    { word: "alit", hint: "Kecil (krama)", category: "Sifat" },
    { word: "kathah", hint: "Banyak (krama)", category: "Jumlah" },
    { word: "sakedhik", hint: "Sedikit (krama)", category: "Jumlah" },
    { word: "punapa", hint: "Apa (krama)", category: "Tanya" },
    { word: "sinten", hint: "Siapa (krama)", category: "Tanya" },
    { word: "kapan", hint: "Kapan (krama)", category: "Tanya" },
    { word: "kados", hint: "Seperti/bagaimana (krama)", category: "Tanya" },
    { word: "pundi", hint: "Dimana (krama)", category: "Tanya" },
    { word: "wonten", hint: "Ada (krama)", category: "Kata Kerja" },
    { word: "sampun", hint: "Sudah (krama)", category: "Keterangan" },
    { word: "dereng", hint: "Belum (krama)", category: "Keterangan" },
    { word: "mboten", hint: "Tidak (krama)", category: "Negasi" },
    { word: "inggih", hint: "Ya (krama)", category: "Jawaban" },
    { word: "boten", hint: "Tidak/bukan (krama)", category: "Negasi" },
    { word: "bapak", hint: "Ayah (krama)", category: "Keluarga" },
    { word: "ibu", hint: "Ibu (krama)", category: "Keluarga" },
    { word: "putra", hint: "Anak laki-laki (krama)", category: "Keluarga" },
    { word: "putri", hint: "Anak perempuan (krama)", category: "Keluarga" },
    { word: "enjing", hint: "Pagi (krama)", category: "Waktu" },
    { word: "siyang", hint: "Siang (krama)", category: "Waktu" },
    { word: "sonten", hint: "Sore (krama)", category: "Waktu" },
    { word: "dalu", hint: "Malam (krama)", category: "Waktu" },
    { word: "benjang", hint: "Besok (krama)", category: "Waktu" },
    { word: "kala", hint: "Kemarin (krama)", category: "Waktu" },
    { word: "batik", hint: "Kain tradisional bermotif", category: "Budaya" },
    { word: "keris", hint: "Senjata tradisional Jawa", category: "Budaya" },
    { word: "tembang", hint: "Lagu/nyanyian Jawa", category: "Budaya" },
    { word: "kenduri", hint: "Selamatan/syukuran", category: "Budaya" },
    { word: "ngalap", hint: "Mengambil (krama)", category: "Kata Kerja" },
  ],
  indonesia: [
    {
      word: "komputer",
      hint: "Alat elektronik untuk bekerja",
      category: "Teknologi",
    },
    {
      word: "internet",
      hint: "Jaringan komputer global",
      category: "Teknologi",
    },
    { word: "aplikasi", hint: "Program software", category: "Teknologi" },
    { word: "website", hint: "Halaman di internet", category: "Teknologi" },
    { word: "smartphone", hint: "Telepon pintar", category: "Teknologi" },
    { word: "laptop", hint: "Komputer portable", category: "Teknologi" },
    { word: "sekolah", hint: "Tempat menuntut ilmu", category: "Tempat" },
    { word: "universitas", hint: "Perguruan tinggi", category: "Tempat" },
    {
      word: "perpustakaan",
      hint: "Tempat menyimpan banyak buku",
      category: "Tempat",
    },
    {
      word: "belajar",
      hint: "Aktivitas menuntut ilmu",
      category: "Kata Kerja",
    },
    { word: "guru", hint: "Orang yang mengajar", category: "Profesi" },
    { word: "murid", hint: "Orang yang belajar", category: "Profesi" },
    { word: "mahasiswa", hint: "Pelajar universitas", category: "Profesi" },
    { word: "dosen", hint: "Pengajar di universitas", category: "Profesi" },
    { word: "buku", hint: "Media untuk membaca", category: "Alat Tulis" },
    {
      word: "pensil",
      hint: "Alat tulis yang bisa dihapus",
      category: "Alat Tulis",
    },
    { word: "pulpen", hint: "Alat tulis tinta", category: "Alat Tulis" },
    {
      word: "penghapus",
      hint: "Alat untuk menghapus tulisan",
      category: "Alat Tulis",
    },
    {
      word: "penggaris",
      hint: "Alat untuk membuat garis lurus",
      category: "Alat Tulis",
    },
    {
      word: "kamus",
      hint: "Buku untuk cari arti kata",
      category: "Alat Tulis",
    },
    { word: "kertas", hint: "Media menulis", category: "Alat Tulis" },
    { word: "teman", hint: "Orang yang menemani kita", category: "Sosial" },
    { word: "sahabat", hint: "Teman dekat", category: "Sosial" },
    { word: "keluarga", hint: "Orang-orang terdekat", category: "Sosial" },
    {
      word: "tetangga",
      hint: "Orang yang tinggal di sekitar rumah",
      category: "Sosial",
    },
    { word: "makanan", hint: "Yang kita makan", category: "Konsumsi" },
    { word: "minuman", hint: "Yang kita minum", category: "Konsumsi" },
    { word: "sarapan", hint: "Makan pagi", category: "Konsumsi" },
    {
      word: "makan",
      hint: "Aktivitas mengonsumsi makanan",
      category: "Kata Kerja",
    },
    {
      word: "minum",
      hint: "Aktivitas mengonsumsi cairan",
      category: "Kata Kerja",
    },
    { word: "masak", hint: "Membuat makanan", category: "Kata Kerja" },
    {
      word: "sepeda",
      hint: "Kendaraan roda dua kayuh",
      category: "Transportasi",
    },
    {
      word: "motor",
      hint: "Kendaraan roda dua bermesin",
      category: "Transportasi",
    },
    { word: "mobil", hint: "Kendaraan roda empat", category: "Transportasi" },
    { word: "bus", hint: "Kendaraan umum besar", category: "Transportasi" },
    { word: "kereta", hint: "Transportasi rel", category: "Transportasi" },
    {
      word: "pesawat",
      hint: "Alat transportasi udara",
      category: "Transportasi",
    },
    { word: "pohon", hint: "Tumbuhan besar berkayu", category: "Alam" },
    { word: "bunga", hint: "Bagian tanaman berwarna indah", category: "Alam" },
    { word: "gunung", hint: "Dataran tinggi", category: "Alam" },
    { word: "laut", hint: "Perairan luas asin", category: "Alam" },
    { word: "sungai", hint: "Aliran air alami", category: "Alam" },
    { word: "danau", hint: "Genangan air luas", category: "Alam" },
    { word: "hujan", hint: "Air turun dari langit", category: "Cuaca" },
    { word: "panas", hint: "Suhu tinggi", category: "Cuaca" },
    { word: "dingin", hint: "Suhu rendah", category: "Cuaca" },
    { word: "mendung", hint: "Langit tertutup awan", category: "Cuaca" },
    { word: "cerah", hint: "Langit terang", category: "Cuaca" },
    { word: "hari", hint: "24 jam", category: "Waktu" },
    { word: "minggu", hint: "7 hari", category: "Waktu" },
    { word: "bulan", hint: "30 hari atau satelit bumi", category: "Waktu" },
    { word: "tahun", hint: "12 bulan", category: "Waktu" },
    { word: "pagi", hint: "Waktu awal hari", category: "Waktu" },
    { word: "siang", hint: "Waktu tengah hari", category: "Waktu" },
    { word: "sore", hint: "Waktu menjelang malam", category: "Waktu" },
    { word: "malam", hint: "Waktu gelap", category: "Waktu" },
    {
      word: "sepakbola",
      hint: "Olahraga menendang bola",
      category: "Olahraga",
    },
    {
      word: "basket",
      hint: "Olahraga memasukkan bola ke ring",
      category: "Olahraga",
    },
    {
      word: "voli",
      hint: "Olahraga memantulkan bola di net",
      category: "Olahraga",
    },
    {
      word: "bulutangkis",
      hint: "Olahraga pakai raket dan kok",
      category: "Olahraga",
    },
  ],
};

let currentLanguage = "";
let currentWordObj = null;
let displayedWord = [];
let guessedLetters = [];
let lives = 5;
let score = 0;
let level = 1;
let wordsCompleted = 0;
let streak = 0;
let bestStreak = 0;
let correctGuesses = 0;
let wrongGuesses = 0;
let hintBonusCount = 3;
let isHardMode = false;
let usedWords = [];
let gameMode = "classic";
let speedrunTimer = null;
let timeRemaining = 60;
let attemptsLeft = 3;
let startTime = null;
let playTime = 0;

function startGame() {
  currentLanguage = document.getElementById("languageSelect").value;
  gameMode = document.querySelector('input[name="gameMode"]:checked').value;

  // Set isHardMode berdasarkan gameMode
  isHardMode = gameMode === "hard";

  if (gameMode === "survival") {
    lives = 1;
    hintBonusCount = 0;
    isHardMode = true;
  } else if (gameMode === "hard") {
    lives = 3;
    hintBonusCount = 3;
    gameMode = "classic"; // Hard mode uses classic mechanics
  } else {
    lives = 5;
    hintBonusCount = 3;
  }

  document.getElementById("setupScreen").style.display = "none";
  document.getElementById("gameScreen").style.display = "block";

  const languageTitles = {
    suroboyoan: "Bahasa Suroboyoan",
    malangan: "Bahasa Malangan",
    jawa: "Bahasa Jawa Krama",
    indonesia: "Bahasa Indonesia",
  };

  const modeSuffix =
    gameMode === "survival"
      ? " (SURVIVAL MODE)"
      : gameMode === "speedrun"
      ? " (SPEEDRUN MODE)"
      : isHardMode
      ? " (HARD MODE)"
      : "";

  document.getElementById("languageTitle").textContent =
    languageTitles[currentLanguage] + modeSuffix;

  if (gameMode === "speedrun") {
    document.getElementById("classicMode").style.display = "none";
    document.getElementById("speedrunMode").style.display = "block";
    document.getElementById("timerDisplay").style.display = "block";
    document.getElementById("statsGrid").style.display = "none";
    document.getElementById("gameStats").style.display = "none";
    startSpeedrunTimer();
  } else {
    document.getElementById("classicMode").style.display = "block";
    document.getElementById("speedrunMode").style.display = "none";
    document.getElementById("timerDisplay").style.display = "none";
    document.getElementById("statsGrid").style.display = "grid";
    document.getElementById("gameStats").style.display = "block";
  }

  startTime = Date.now();
  setInterval(updatePlayTime, 1000);

  loadNewWord();
}

function updatePlayTime() {
  if (startTime) {
    playTime = Math.floor((Date.now() - startTime) / 1000);
    document.getElementById("playTime").textContent = playTime;
  }
}

function startSpeedrunTimer() {
  timeRemaining = 60;
  updateTimerDisplay();

  speedrunTimer = setInterval(() => {
    timeRemaining--;
    updateTimerDisplay();

    if (timeRemaining <= 0) {
      clearInterval(speedrunTimer);
      gameOver();
    }
  }, 1000);
}

function updateTimerDisplay() {
  document.getElementById("timerDisplay").textContent =
    "‚è±Ô∏è Waktu: " + timeRemaining + " detik";

  if (timeRemaining < 10) {
    document.getElementById("timerDisplay").style.color = "#dc2626";
  } else if (timeRemaining < 30) {
    document.getElementById("timerDisplay").style.color = "#ea580c";
  } else {
    document.getElementById("timerDisplay").style.color = "#16a34a";
  }
}

function loadNewWord() {
  const words = wordDatabase[currentLanguage];
  let availableWords = words.filter((w) => !usedWords.includes(w.word));

  if (availableWords.length === 0) {
    usedWords = [];
    availableWords = words;
  }

  currentWordObj =
    availableWords[Math.floor(Math.random() * availableWords.length)];
  usedWords.push(currentWordObj.word);

  guessedLetters = [];
  displayedWord = Array(currentWordObj.word.length).fill("_");
  attemptsLeft = 3;

  updateDisplay();
  document.getElementById("hint").textContent = currentWordObj.hint;
  document.getElementById("wordLength").textContent =
    currentWordObj.word.length;

  if (!isHardMode && gameMode !== "survival") {
    document.getElementById("categoryHint").innerHTML =
      "<p>üìÇ Kategori: <strong>" + currentWordObj.category + "</strong></p>";
  } else {
    document.getElementById("categoryHint").innerHTML = "";
  }

  document.getElementById("message").textContent = "";
  document.getElementById("guessInput").value = "";
  document.getElementById("fullWordInput").value = "";

  if (gameMode === "classic") {
    document.getElementById("guessInput").focus();
  } else {
    document.getElementById("fullWordInput").focus();
  }
}

function updateDisplay() {
  document.getElementById("wordDisplay").textContent = displayedWord.join(" ");
  document.getElementById("guessedLetters").textContent =
    guessedLetters.length > 0 ? guessedLetters.join(", ").toUpperCase() : "-";
  document.getElementById("lives").textContent = lives;
  document.getElementById("score").textContent = score;
  document.getElementById("level").textContent = level;
  document.getElementById("streak").textContent = streak;
  document.getElementById("hintBonus").textContent = hintBonusCount;
  document.getElementById("totalWords").textContent = wordsCompleted;
  document.getElementById("correctGuesses").textContent = correctGuesses;
  document.getElementById("wrongGuesses").textContent = wrongGuesses;
  document.getElementById("attemptsLeft").textContent = attemptsLeft;

  let totalGuesses = correctGuesses + wrongGuesses;
  let accuracy =
    totalGuesses > 0 ? Math.round((correctGuesses / totalGuesses) * 100) : 100;
  document.getElementById("accuracy").textContent = accuracy;
}

function guessLetter() {
  const input = document
    .getElementById("guessInput")
    .value.toLowerCase()
    .trim();

  if (!input) {
    showMessage("‚ùå Masukkan huruf dulu!", "red");
    return;
  }

  if (!/^[a-z]$/.test(input)) {
    showMessage("‚ùå Hanya huruf a-z saja ya!", "red");
    document.getElementById("guessInput").value = "";
    return;
  }

  if (guessedLetters.includes(input)) {
    showMessage(
      '‚ö†Ô∏è Huruf "' + input.toUpperCase() + '" sudah kamu tebak!',
      "orange"
    );
    document.getElementById("guessInput").value = "";
    return;
  }

  guessedLetters.push(input);

  let found = false;
  let foundCount = 0;

  for (let i = 0; i < currentWordObj.word.length; i++) {
    if (currentWordObj.word[i].toLowerCase() === input) {
      displayedWord[i] = currentWordObj.word[i];
      found = true;
      foundCount++;
    }
  }

  if (found) {
    showMessage(
      '‚úÖ Benar! Huruf "' +
        input.toUpperCase() +
        '" ada ' +
        foundCount +
        " kali!",
      "green"
    );
    score += 10 * foundCount;
    correctGuesses++;

    if (!displayedWord.includes("_")) {
      wordCompleted();
    }
  } else {
    showMessage(
      '‚ùå Salah! Huruf "' + input.toUpperCase() + '" tidak ada!',
      "red"
    );
    lives--;
    wrongGuesses++;
    streak = 0;

    if (lives <= 0) {
      gameOver();
      return;
    }
  }

  updateDisplay();
  document.getElementById("guessInput").value = "";
}

function guessFullWord() {
  const input = document
    .getElementById("fullWordInput")
    .value.toLowerCase()
    .trim();

  if (!input) {
    showMessage("‚ùå Masukkan kata lengkap!", "red");
    return;
  }

  if (input === currentWordObj.word.toLowerCase()) {
    displayedWord = currentWordObj.word.split("");

    let timeBonus = gameMode === "speedrun" ? timeRemaining * 5 : 0;
    score += 100 + timeBonus;
    correctGuesses++;

    showMessage("üéâ BENAR SEMPURNA! +" + (100 + timeBonus) + " poin!", "green");
    wordCompleted();
  } else {
    attemptsLeft--;
    wrongGuesses++;
    updateDisplay();

    if (attemptsLeft <= 0) {
      lives--;
      streak = 0;
      updateDisplay();

      if (lives <= 0 || gameMode === "speedrun") {
        showMessage('‚ùå Salah! Kata: "' + currentWordObj.word + '"', "red");
        setTimeout(gameOver, 2000);
        return;
      } else {
        showMessage(
          '‚ùå Kesempatan habis! Kata: "' + currentWordObj.word + '" (-1 Nyawa)',
          "red"
        );
        setTimeout(loadNewWord, 2500);
      }
    } else {
      showMessage("‚ùå Salah! Sisa " + attemptsLeft + " kesempatan", "red");
    }
  }

  document.getElementById("fullWordInput").value = "";
}

function useHintBonus() {
  if (hintBonusCount <= 0) {
    showMessage("‚ùå Bonus hint sudah habis!", "red");
    return;
  }

  let hiddenIndices = [];
  for (let i = 0; i < displayedWord.length; i++) {
    if (displayedWord[i] === "_") {
      hiddenIndices.push(i);
    }
  }

  if (hiddenIndices.length === 0) {
    showMessage("‚ö†Ô∏è Semua huruf sudah terbuka!", "orange");
    return;
  }

  let randomIndex =
    hiddenIndices[Math.floor(Math.random() * hiddenIndices.length)];
  let revealedLetter = currentWordObj.word[randomIndex];
  displayedWord[randomIndex] = revealedLetter;

  if (!guessedLetters.includes(revealedLetter.toLowerCase())) {
    guessedLetters.push(revealedLetter.toLowerCase());
  }

  hintBonusCount--;
  showMessage(
    'üí° Hint: Huruf "' + revealedLetter.toUpperCase() + '" terbuka!',
    "blue"
  );

  if (!displayedWord.includes("_")) {
    wordCompleted();
  } else {
    updateDisplay();
  }
}

function wordCompleted() {
  score += 50;
  wordsCompleted++;
  streak++;

  if (streak > bestStreak) {
    bestStreak = streak;
  }

  if (streak >= 3) {
    let streakBonus = streak * 10;
    score += streakBonus;
    showMessage(
      'üéâ Kata benar: "' +
        currentWordObj.word +
        '"! +' +
        streakBonus +
        " bonus streak!",
      "green"
    );
  } else {
    showMessage('üéâ Benar! Kata: "' + currentWordObj.word + '"', "green");
  }

  if (wordsCompleted % 3 === 0 && gameMode !== "speedrun") {
    level++;
    if (gameMode !== "survival") {
      lives = Math.min(lives + 1, isHardMode ? 3 : 5);
      hintBonusCount = Math.min(hintBonusCount + 1, 5);
      showMessage(
        "üéä LEVEL " + level + "! Bonus: +1 Nyawa & +1 Hint!",
        "purple"
      );
    } else {
      showMessage("üéä LEVEL " + level + "! Kamu masih bertahan!", "purple");
    }
  }

  if (gameMode === "speedrun") {
    timeRemaining += 10;
    showMessage("‚è±Ô∏è +10 detik bonus!", "blue");
  }

  updateDisplay();

  setTimeout(() => {
    loadNewWord();
  }, 2500);
}

function skipWord() {
  lives--;
  streak = 0;
  showMessage('‚è≠Ô∏è Skip! Kata: "' + currentWordObj.word + '"', "gray");

  if (lives <= 0) {
    gameOver();
  } else {
    updateDisplay();
    setTimeout(() => {
      loadNewWord();
    }, 2000);
  }
}

function giveUp() {
  showMessage('üè≥Ô∏è Menyerah! Kata: "' + currentWordObj.word + '"', "gray");
  setTimeout(gameOver, 2000);
}

function resetGame() {
  lives = gameMode === "survival" ? 1 : isHardMode ? 3 : 5;
  score = 0;
  level = 1;
  wordsCompleted = 0;
  streak = 0;
  correctGuesses = 0;
  wrongGuesses = 0;
  hintBonusCount = gameMode === "survival" ? 0 : 3;
  usedWords = [];

  if (gameMode === "speedrun") {
    clearInterval(speedrunTimer);
    startSpeedrunTimer();
  }

  loadNewWord();
}

function gameOver() {
  if (speedrunTimer) {
    clearInterval(speedrunTimer);
  }

  document.getElementById("gameScreen").style.display = "none";
  document.getElementById("gameOverScreen").style.display = "block";

  const modeNames = {
    classic: "Classic",
    speedrun: "Speedrun",
    survival: "Survival",
  };

  document.getElementById("finalMode").textContent =
    modeNames[gameMode] +
    (isHardMode && gameMode === "classic" ? " (Hard)" : "");
  document.getElementById("finalScore").textContent = score;
  document.getElementById("finalLevel").textContent = level;
  document.getElementById("finalWords").textContent = wordsCompleted;

  let totalGuesses = correctGuesses + wrongGuesses;
  let finalAccuracy =
    totalGuesses > 0 ? Math.round((correctGuesses / totalGuesses) * 100) : 100;
  document.getElementById("finalAccuracy").textContent = finalAccuracy;
  document.getElementById("bestStreak").textContent = bestStreak;
  document.getElementById("finalTime").textContent = playTime;
}

function showMessage(text, color) {
  const msgElement = document.getElementById("message");
  msgElement.textContent = text;
  msgElement.style.color = color || "black";
}

document.addEventListener("DOMContentLoaded", function () {
  const guessInput = document.getElementById("guessInput");
  const fullWordInput = document.getElementById("fullWordInput");

  if (guessInput) {
    guessInput.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        guessLetter();
      }
    });

    guessInput.addEventListener("input", function (e) {
      this.value = this.value.toLowerCase();
    });
  }

  if (fullWordInput) {
    fullWordInput.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        guessFullWord();
      }
    });

    fullWordInput.addEventListener("input", function (e) {
      this.value = this.value.toLowerCase();
    });
  }
});
